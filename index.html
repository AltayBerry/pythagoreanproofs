<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pythagorean Proofs</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Fonts for modern typography -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    :root {
      --primary-color: #ffc107;
      --primary-dark: #e0a800;
      --background-color: rgba(0, 0, 0, 0.85);
      --text-color: #ffffff;
      --hover-bg: rgba(255, 255, 255, 0.1);
      --font-family: 'Open Sans', sans-serif;
    }
    body {
      padding-top: 60px;
      font-family: var(--font-family);
      background-color: #f8f9fa;
    }
    html {
      scroll-behavior: smooth;
    }
    .navbar {
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
      box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
      background: var(--background-color);
      backdrop-filter: blur(5px);
      border-bottom: 3px solid var(--primary-color);
    }
    .navbar-nav .nav-item .nav-link {
      color: var(--text-color);
      transition: color 0.3s, background 0.3s;
    }
    .navbar-nav .nav-item .nav-link:hover,
    .navbar-nav .nav-item .nav-link.active {
      color: var(--primary-color);
      background: var(--hover-bg);
      border-radius: 5px;
    }
    .proof-image {
      width: 100%;
      max-width: 400px;
      height: auto;
      object-fit: contain;
      border-radius: 8px;
      border: 2px solid var(--primary-color);
    }
    /* Fade-in animation styles */
    .fade-element {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 1s ease-out, transform 1s ease-out;
    }
    .fade-element.visible {
      opacity: 1;
      transform: translateY(0);
    }
    /* Back-to-top button */
    #backToTop {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--primary-color);
      color: #000;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
    }
    #backToTop:hover {
      background-color: var(--primary-dark);
    }
    /* Responsive canvas */
    #triangleCanvas {
      max-width: 100%;
      height: auto;
    }
    /* Shake animation for incorrect answer */
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
    .shake {
      animation: shake 0.5s;
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark" aria-label="Main Navigation">
    <div class="container">
      <a class="navbar-brand" href="#" aria-label="Pythagorean Proofs Home">
        Pythagorean Proofs
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="#bhaskara">Bhaskara's Proof</a></li>
          <li class="nav-item"><a class="nav-link" href="#garfield">Garfield's Proof</a></li>
          <li class="nav-item"><a class="nav-link" href="#similarity">Similarity Proof</a></li>
          <li class="nav-item"><a class="nav-link" href="#euclid">Euclid's Proof</a></li>
          <li class="nav-item"><a class="nav-link" href="#algebraic">Algebraic Proof</a></li>
          <li class="nav-item"><a class="nav-link" href="#minigame">Minigame</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container my-5">
    <section id="bhaskara" class="mb-5 fade-element">
      <h2 class="mb-3">Bhaskara's Proof</h2>
      <img id="bhaskaraImg" src="image1_bhaskara.jpg" alt="Diagram showing Bhaskara's proof of the Pythagorean theorem." class="img-fluid proof-image mb-3" loading="lazy">
      <button class="btn btn-primary mb-3 toggle-btn" 
              data-target="bhaskaraImg" 
              data-img1="image1_bhaskara.jpg" 
              data-img2="image2_bhaskara.jpg" 
              aria-label="Toggle Bhaskara's Proof image">Toggle Image</button>
      <p>Content for Bhaskara's Proof goes here.</p>
    </section>
    <section id="garfield" class="mb-5 fade-element">
      <h2 class="mb-3">Garfield's Proof</h2>
      <img id="garfieldImg" src="image1_garfield.jpg" alt="Diagram illustrating Garfield's proof of the Pythagorean theorem." class="img-fluid proof-image mb-3" loading="lazy">
      <button class="btn btn-primary mb-3 toggle-btn" 
              data-target="garfieldImg" 
              data-img1="image1_garfield.jpg" 
              data-img2="image2_garfield.jpg" 
              aria-label="Toggle Garfield's Proof image">Toggle Image</button>
      <p>Content for Garfield's Proof goes here.</p>
    </section>
    <section id="similarity" class="mb-5 fade-element">
      <h2 class="mb-3">Similarity Proof</h2>
      <img id="similarityImg" src="image1_similarity.jpg" alt="Diagram depicting the Similarity Proof of the Pythagorean theorem." class="img-fluid proof-image mb-3" loading="lazy">
      <button class="btn btn-primary mb-3 toggle-btn" 
              data-target="similarityImg" 
              data-img1="image1_similarity.jpg" 
              data-img2="image2_similarity.jpg" 
              aria-label="Toggle Similarity Proof image">Toggle Image</button>
      <p>Content for Similarity Proof goes here.</p>
    </section>
    <section id="euclid" class="mb-5 fade-element">
      <h2 class="mb-3">Euclid's Proof</h2>
      <img id="euclidImg" src="image1_euclid.jpg" alt="Diagram representing Euclid's proof of the Pythagorean theorem." class="img-fluid proof-image mb-3" loading="lazy">
      <button class="btn btn-primary mb-3 toggle-btn" 
              data-target="euclidImg" 
              data-img1="image1_euclid.jpg" 
              data-img2="image2_euclid.jpg" 
              aria-label="Toggle Euclid's Proof image">Toggle Image</button>
      <p>Content for Euclid's Proof goes here.</p>
    </section>
    <section id="algebraic" class="mb-5 fade-element">
      <h2 class="mb-3">Algebraic Proof</h2>
      <img id="algebraicImg" src="image1_algebraic.jpg" alt="Diagram illustrating the Algebraic Proof of the Pythagorean theorem." class="img-fluid proof-image mb-3" loading="lazy">
      <button class="btn btn-primary mb-3 toggle-btn" 
              data-target="algebraicImg" 
              data-img1="image1_algebraic.jpg" 
              data-img2="image2_algebraic.jpg" 
              aria-label="Toggle Algebraic Proof image">Toggle Image</button>
      <p>Content for Algebraic Proof goes here.</p>
    </section>
  </div>

  <!-- Mini-Game: Find the Missing Side -->
  <div id="minigame" class="container my-5 fade-element">
    <h2 class="text-center">Find the Missing Side!</h2>
    <p class="text-center">Use the Pythagorean Theorem (a¬≤ + b¬≤ = c¬≤) to find the missing side.</p>
    <div class="text-center">
      <p><strong>Given:</strong> <span id="problemText"></span></p>
      <canvas id="triangleCanvas" width="200" height="200" role="img" aria-label="Triangle diagram for Pythagorean minigame"></canvas>
      <br>
      <input type="number" id="userAnswer" class="form-control w-25 d-inline" placeholder="Enter missing side" aria-label="Your answer" disabled>
      <!-- Game button will toggle between Start (yellow) and Submit (green) -->
      <button id="gameButton" class="btn btn-warning" aria-label="Start game">Start</button>
    </div>
    <!-- Enhanced minigame elements: score and timer -->
    <p id="scoreDisplay" class="text-center mt-3">Score: 0</p>
    <p id="timerDisplay" class="text-center mt-3">Time Left: 15s</p>
    <p id="gameResult" class="text-center mt-3"></p>
  </div>

  <!-- Back-to-Top Button -->
  <button id="backToTop" aria-label="Back to top">‚Üë</button>

  <script>
    // Refactored image toggle function using data attributes
    function toggleImage(event) {
      const button = event.currentTarget;
      const img = document.getElementById(button.dataset.target);
      const img1 = button.dataset.img1;
      const img2 = button.dataset.img2;
      const currentSrc = img.getAttribute('src').split('/').pop();
      if (currentSrc === img1.split('/').pop()) {
        img.src = img2;
      } else {
        img.src = img1;
      }
    }

    // Enhanced minigame variables and state
    let sideA, sideB, missingSide, findHypotenuse;
    let score = 0;
    let timeLeft = 15;
    let timerInterval = null;
    let gameActive = false;
    // Global timer limit for current round; decreases by 0.5 sec per correct answer (min 5 sec)
    let currentTimeLimit = 15;

    // Starts a new game session (reset timer limit)
    function startGame() {
      gameActive = true;
      currentTimeLimit = 15; // reset timer for new session
      score = 0;
      document.getElementById("scoreDisplay").textContent = "Score: " + score;
      // Update button to Submit (green) and enable the input field
      const gameButton = document.getElementById("gameButton");
      gameButton.textContent = "Submit";
      gameButton.className = "btn btn-success";
      document.getElementById("userAnswer").disabled = false;
      document.getElementById("userAnswer").focus();
      // Start a new triangle round and timer
      generateTriangle();
    }

    // Ends the current game (on timeout) and resets the button back to Start (yellow)
    function endGame() {
      gameActive = false;
      clearInterval(timerInterval);
      document.getElementById("gameButton").textContent = "Start";
      document.getElementById("gameButton").className = "btn btn-warning";
      document.getElementById("userAnswer").disabled = true;
      // Reset currentTimeLimit for a new session
      currentTimeLimit = 15;
    }

    function generateTriangle() {
      clearInterval(timerInterval);
      timeLeft = currentTimeLimit;
      document.getElementById("timerDisplay").textContent = "Time Left: " + timeLeft + "s";
      startTimer();

      const triples = [[3,4,5], [5,12,13], [7,24,25], [8,15,17], [9,12,15]];
      const chosen = triples[Math.floor(Math.random() * triples.length)];
      const problemText = document.getElementById("problemText");
      if (Math.random() < 0.5) {
        findHypotenuse = true;
        sideA = chosen[0];
        sideB = chosen[1];
        missingSide = chosen[2];
        problemText.textContent = `Side A = ${sideA}, Side B = ${sideB}. Find the Hypotenuse!`;
      } else {
        findHypotenuse = false;
        sideA = chosen[2];  // Hypotenuse
        sideB = chosen[0];  // One known leg
        missingSide = chosen[1];  // The other missing leg
        problemText.textContent = `Hypotenuse = ${sideA}, Side B = ${sideB}. Find the Missing Leg!`;
      }
      drawTriangle();
      document.getElementById("userAnswer").value = "";
      document.getElementById("gameResult").textContent = "";
    }
    
    function startTimer() {
      timerInterval = setInterval(() => {
        timeLeft--;
        document.getElementById("timerDisplay").textContent = "Time Left: " + timeLeft + "s";
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          document.getElementById("gameResult").innerHTML = "<span class='text-danger'>‚è∞ Time's up! The correct answer was " + missingSide + ".</span>";
          setTimeout(endGame, 2000);
        }
      }, 1000);
    }
    
    function drawTriangle() {
      const canvas = document.getElementById("triangleCanvas");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const scaleFactor = Math.min(canvas.width / 2 / Math.max(sideA, sideB, missingSide), 20);
      const x1 = 20, y1 = canvas.height - 20;
      const x2 = x1 + sideB * scaleFactor, y2 = y1;
      const x3 = x1, y3 = y1 - (findHypotenuse ? sideA : missingSide) * scaleFactor;
      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.lineTo(x3, y3);
      ctx.closePath();
      ctx.strokeStyle = "black";
      ctx.lineWidth = 3;
      ctx.stroke();
      ctx.font = "14px Arial";
      ctx.fillStyle = "blue";
      ctx.fillText(sideB, (x1 + x2) / 2, y1 + 15);
      ctx.fillText(findHypotenuse ? sideA : "?", x3 - 20, (y1 + y3) / 2);
      ctx.fillText(findHypotenuse ? "?" : sideA, (x2 + x3) / 2, (y2 + y3) / 2 - 10);
    }
    
    function checkAnswer() {
      const userInput = document.getElementById("userAnswer");
      const result = document.getElementById("gameResult");
      const userGuess = parseInt(userInput.value);
      if (isNaN(userGuess)) {
        result.innerHTML = "<span class='text-warning'>Please enter a number!</span>";
        return;
      }
      if (userGuess === missingSide) {
        clearInterval(timerInterval);
        // Add the remaining time to the score
        score += timeLeft;
        document.getElementById("scoreDisplay").textContent = "Score: " + score;
        result.innerHTML = "<span class='text-success'>üéâ Correct! Well done!</span>";
        userInput.classList.add("success");
        // Decrease the time limit for next round by 0.5 sec (min 5 sec)
        currentTimeLimit = Math.max(5, currentTimeLimit - 0.5);
        // Continue game by generating a new triangle after a short delay
        setTimeout(generateTriangle, 2000);
      } else {
        result.innerHTML = "<span class='text-danger'>‚ùå Incorrect, try again!</span>";
        userInput.classList.add("shake");
        setTimeout(() => userInput.classList.remove("shake"), 500);
      }
    }
    
    // Handler for the game button click (start if inactive, submit answer if active)
    function handleGameButtonClick() {
      if (!gameActive) {
        startGame();
      } else {
        checkAnswer();
      }
    }
    
    // Active navigation state based on scroll position
    function updateActiveNav() {
      const sections = document.querySelectorAll("section");
      const scrollPos = document.documentElement.scrollTop || document.body.scrollTop;
      sections.forEach(section => {
        const offsetTop = section.offsetTop - 70;
        const offsetHeight = section.offsetHeight;
        const id = section.getAttribute("id");
        if (scrollPos >= offsetTop && scrollPos < offsetTop + offsetHeight) {
          document.querySelectorAll(".navbar-nav .nav-link").forEach(link => {
            link.classList.remove("active");
            if (link.getAttribute("href") === "#" + id) {
              link.classList.add("active");
            }
          });
        }
      });
    }
    
    // Back-to-top button functionality
    function setupBackToTop() {
      const backToTop = document.getElementById("backToTop");
      window.addEventListener("scroll", () => {
        backToTop.style.display = window.scrollY > 300 ? "flex" : "none";
      });
      backToTop.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    }
    
    // Fade-in animation using Intersection Observer
    function setupFadeIn() {
      const faders = document.querySelectorAll('.fade-element');
      const options = {
        threshold: 0.2
      };
      const appearOnScroll = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      }, options);
      faders.forEach(fader => {
        appearOnScroll.observe(fader);
      });
    }
    
    // Register event listeners on DOMContentLoaded
    document.addEventListener("DOMContentLoaded", () => {
      // Attach toggle event to image toggle buttons
      document.querySelectorAll(".toggle-btn").forEach(button => {
        button.addEventListener("click", toggleImage);
      });
      // Attach event listener to the game button
      document.getElementById("gameButton").addEventListener("click", handleGameButtonClick);
      // Allow "Enter" key submission in the answer input when game is active
      document.getElementById("userAnswer").addEventListener("keypress", function(event) {
        if (event.key === "Enter" && gameActive) {
          event.preventDefault();
          checkAnswer();
        }
      });
      // Setup active nav updates, back-to-top button, and fade in animations
      window.addEventListener("scroll", updateActiveNav);
      setupBackToTop();
      setupFadeIn();
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
